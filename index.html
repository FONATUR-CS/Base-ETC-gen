<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Turismo Comunitario – México</title>

  <style id="leaflet-css">
    .leaflet-container { position: relative; overflow: hidden; outline: 0; }
    .leaflet-pane, .leaflet-tile, .leaflet-marker-icon, .leaflet-marker-shadow,
    .leaflet-zoom-box, .leaflet-image-layer, .leaflet-overlay-pane svg,
    .leaflet-overlay-pane canvas { position:absolute; left:0; top:0; }
    .leaflet-zoom-animated { transform-origin: 0 0; }
    .leaflet-control { pointer-events: auto; }
  </style>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet"/>

  <style>@layer gobmx, app;</style>

  <link href="https://framework-gb.cdn.gob.mx/gm/v3/assets/styles/main.css" rel="stylesheet" layer="gobmx" />

  <style>
    /* ====== App CSS (Versión Mejorada) ====== */
    :root{
      font-size:16px;
      --primary:#2E8B57;
      --accent: #EA5188; /* ✨ MEJORA: Definimos el color de acento como variable */
      --light-bg:#fafafa;
      --nav-h:56px;
      --footer-h:clamp(56px,8vw,90px);
    }
    @media (max-width:768px){ :root{ font-size:14px; } }

    html,body{
      height:100%;
      font-family:'Noto Sans',sans-serif;
      color:#fff;
      background-image:url('img/patron1.jpg');
      background-size:cover; background-position:center;
      background-repeat:no-repeat; background-attachment:fixed;
      margin:0; padding:0;
      position: relative; /* ✨ MEJORA: Necesario para el overlay */
    }

    /* ✨ MEJORA: Overlay sutil para mejorar el contraste del texto */
    body::before {
        content: '';
        position: fixed;
        inset: 0;
        background: rgba(40, 40, 40, 0.3);
        z-index: -1;
    }

    /* NAV fijo */
    #main-nav{
      position:fixed; top:0; left:0; width:100%;
      padding:10px 30px; z-index:10000;
      box-shadow:0 4px 12px rgba(0,0,0,.25); /* ✨ MEJORA: Sombra más pronunciada */
      background-image:url('img/patron2.jpg');
      background-size:cover; background-position:center;
      background-repeat:no-repeat; background-attachment:fixed;
      margin-bottom:0 !important;
    }
    #main-nav::before{ content:""; position:absolute; inset:0; background:rgba(0,0,0,0.0); pointer-events:none; } /* ✨ MEJORA: Overlay también en el nav */
    #main-nav>*{ position:relative; z-index:1; }
    #main-nav ul{ list-style:none; display:flex; gap:1rem; margin:0; padding:0; }
    #main-nav a{
      text-decoration:none;
      color:#fff; /* ✨ MEJORA: Texto blanco para mejor contraste en nav */
      font-weight:700;
      padding:6px 12px; /* ✨ MEJORA: Un poco más de padding horizontal */
      border-radius:6px; /* ✨ MEJORA: Bordes redondeados */
      transition: background-color 0.3s, color 0.3s; /* ✨ MEJORA: Transición suave */
      text-shadow: 1px 1px 3px rgba(0,0,0,0.5); /* ✨ MEJORA: Sombra de texto */
    }
    #main-nav a.active, #main-nav a:hover{ background:var(--accent); color:#fff; }
    @media (max-width:768px){ #main-nav{ background-attachment:scroll; } }

    /* Menú hamburguesa */
    #nav-toggle{
      display:none; background:none; border:none; font-size:1.8em; cursor:pointer;
      color: white; /* ✨ MEJORA: Asegurar que el ícono sea visible */
      text-shadow: 1px 1px 3px rgba(0,0,0,0.5); /* ✨ MEJORA: Sombra para visibilidad */
    }
    #nav-menu{ list-style:none; display:flex; gap:1em; }
    @media (max-width:768px){
      #nav-toggle{ display:block; position:fixed; top:10px; right:20px; z-index:1200; }
      #nav-menu{
        position:fixed; top:0; right:0; background:#333; /* ✨ MEJORA: Fondo oscuro para el menú móvil */
        height:100%; width:75%;
        transform:translateX(100%); flex-direction:column; padding:80px 30px;
        transition:transform .3s ease; box-shadow:-4px 0 15px rgba(0,0,0,.2);
      }
      #nav-menu.open{ transform:translateX(0); }
      #nav-menu li+li{ margin-top:1em; }
      #nav-menu a { color: #fff; } /* ✨ MEJORA: Color de texto para el menú móvil */
    }

    /* Layout principal */
    #container{ display:flex; height:calc(100vh - var(--nav-h)); margin-top:var(--nav-h); }

    /* Panel izquierdo (texto) */
    #story{
      width:50%; padding:30px 40px;
      background: transparent; /* ✨ MEJORA: Hacemos el fondo transparente para que se vea el de body */
      position:relative; margin-top:0 !important; padding-top:0 !important; display:flow-root;
      padding-bottom:calc(var(--footer-h) + 16px);
      overflow-y: auto; /* ✨ MEJORA: Asegurar que el scroll siempre sea posible si el contenido excede */
    }
    #story > *:first-child{ margin-top:0 !important; }
    #story section{ margin-bottom:50px; padding-bottom:20px; border-bottom:1px solid rgba(255,255,255,0.2); } /* ✨ MEJORA: Borde más sutil */
    #story section img{
      display:block; width:100%; height:auto; margin:1.5em 0;
      border-radius: 12px; /* ✨ MEJORA: Bordes redondeados en imágenes */
      box-shadow: 0 4px 15px rgba(0,0,0,0.3); /* ✨ MEJORA: Sombra para dar profundidad */
    }
    #story section.is-active{ opacity:1; }
    #story h2{
      font-size:1.8em; margin-bottom:.5em; color:#FFF2D2;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.7); /* ✨ MEJORA: Sombra para resaltar el título */
    }
    #story p{
      margin-bottom:1em; line-height:1.7; /* ✨ MEJORA: Mayor interlineado */
      text-align:left; /* ✨ MEJORA: Mejor legibilidad que justificado */
      text-shadow: 1px 1px 3px rgba(0,0,0,0.7); /* ✨ MEJORA: Sombra de texto */
    }
    #story ul{ margin-left:1.2em; list-style:disc; }
    #story li{ margin-bottom:.6em; transition:color .3s; text-shadow: 1px 1px 3px rgba(0,0,0,0.7); }
    #story li a{ text-decoration:none; color:var(--accent); font-weight: bold; }
    #story li a:hover{ text-decoration:underline; color:#fff; }

    /* Panel derecho (mapa) */
    #map{
      position:fixed; top:var(--nav-h); right:0; width:50%;
      height:calc(100% - var(--nav-h) - var(--footer-h));
      z-index:500;
      border-left:2px solid rgba(255,255,255,0.2); /* ✨ MEJORA: Borde más sutil */
      box-shadow:-4px 0 15px rgba(0,0,0,.2);
      background:#fafafa; pointer-events:auto;
      border-radius: 12px 0 0 0; /* ✨ MEJORA: Redondeo en la esquina superior izquierda */
    }

    /* Scrollbar personalizado del texto */
    #story::-webkit-scrollbar{ width:10px; }
    #story::-webkit-scrollbar-track{ background:rgba(0,0,0,0.1); }
    #story::-webkit-scrollbar-thumb{
      background:var(--accent); /* ✨ MEJORA: Scrollbar con el color de acento */
      border-radius:10px;
      border: 2px solid transparent;
      background-clip: content-box;
    }
    #story::-webkit-scrollbar-thumb:hover{ background: #c74572; } /* ✨ MEJORA: Versión más oscura del acento al pasar el cursor */

    /* Banner inferior fijo */
    #footer-banner{
      position:fixed; left:0; right:0; bottom:0; height:var(--footer-h); z-index:1100;
      background-image:url('img/patron2.jpg');
      background-size:cover; background-position:center;
      background-repeat:no-repeat; background-attachment:fixed;
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.25); /* ✨ MEJORA: Sombra superior */
    }
    #footer-banner img{ width:100%; height:100%; object-fit:contain; padding:4px 12px; display:block; }

    /* Animación de “respirar” para polígonos */
    @keyframes respirar{ 0%{filter:drop-shadow(0 0 0px var(--accent));} 50%{filter:drop-shadow(0 0 14px var(--accent));} 100%{filter:drop-shadow(0 0 0px var(--accent));} }
    .estado-respirar{ animation:respirar 1.8s infinite; }

    /* Responsive */
    @media (max-width:1024px){ #story{ width:60%; } #map{ width:40%; } }
    @media (max-width:768px){
      #container{ display:block; margin-top:var(--nav-h); }
      #story{
        width:100%; max-height:none;
        padding-bottom:calc(var(--footer-h) + 12px);
        border-bottom:none;
      }
      #map{
        width:100%; height:calc(50vh - var(--footer-h)); position:relative; top:auto; right:auto;
        border-top:2px solid rgba(255,255,255,0.2); /* ✨ MEJORA: Borde más sutil */
        border-radius: 0; /* ✨ MEJORA: Quitar redondeo en móvil */
      }
      #footer-banner img{ padding:6px 10px; }
    }
  </style>
</head>
<body>

  <nav id="main-nav">
    <button id="nav-toggle" aria-label="Abrir menú">☰</button>
    <ul id="nav-menu">
      <li><a href="index.html" class="active">Inicio</a></li>
      <li><a href="estados/baja_california_sur.html">Baja California Sur</a></li>
      <li><a href="estados/hidalgo.html">Hidalgo</a></li>
      <li><a href="estados/michoacan.html">Michoacán</a></li>
      <li><a href="estados/morelos.html">Morelos</a></li>
      <li><a href="estados/nayarit.html">Nayarit</a></li>
      <li><a href="estados/oaxaca.html">Oaxaca</a></li>
      <li><a href="estados/puebla.html">Puebla</a></li>
      <li><a href="estados/tlaxcala.html">Tlaxcala</a></li>
      <li><a href="estados/veracruz.html">Veracruz</a></li>
    </ul>
  </nav>

  <div id="container">
    <div id="story">
      <section data-step="0">
        <h2>Estrategia de Turismo Comunitario en México</h2>
        <p>El turismo comunitario en México es un modelo de desarrollo turístico que busca empoderar a las comunidades locales al involucrarlas directamente a la planificación,
        operación y beneficio de actividades turísticas en sus territorios.</p>
        <p>Este enfoque permite a los visitantes experimentar de manera auténtica la cultura, tradiciones, historia y entorno natural de las comunidades anfitrionas, promoviendo el respeto
        por los recursos naturales y el patrimonio cultural.</p>
        <img src="img/Turismo_9.jpg" alt="Turismo" loading="lazy">
      </section>
      <section data-step="2">
        <h2>Lo esencial del Turismo Comunitario </h2>
        <p>Un turismo donde las actividades, productos y servicios que se ofrecen, son gestionados por las propias comunidades rurales e indígenas.</p>
        <img src="img/Turismo_3.jpg" alt="Turismo" loading="lazy">
      </section>
      <section data-step="3">
        <h2>¿Por qué elegirlo?</h2>
        <p>¡Es un turismo con impacto positivo!</p>
        <ul>
          <li>Ofrece experiencias auténticas</li>
          <li>Apoya la economía local</li>
          <li>Preserva el medio ambiente</li>
        </ul>
        <p>La ONU Turismo lo promueve como una herramienta para el desarrollo sostenible, la preservación de la cultura y el entorno natural.</p> 
        <img src="img/Turismo_4.jpg" alt="Turismo" loading="lazy">
      </section>
      <section data-step="4">
        <h2>Una forma de contribuir al desarrollo local.</h2>
        <p>Es elegir el Turismo Comunitario. Esta es solo una introducción de lo que debes saber sobre él. 🌱.</p>
        <img src="img/Turismo_5.jpg" alt="Turismo" loading="lazy">
      </section>
      <section data-step="5">
        <h2>Actividades que puedes realizar de Turismo Comunitario</h2>
        <p>Todas las actividades son ofrecidas por las propias comunidades locales quienes comparten sus conocimientos, tradiciones y formas de vida fortaleciendo su identidad y cultura.</p>
        <ul>
          <li>Talleres artesanales: Alfarería, bordado, tejido, etc.</li>
          <li>Talleres Gastronómicos: Aprender a preparar platillos locales con ingredientes de la región</li>
          <li>Rutas de naturaleza y aventura guiadas por las comunidades locales como: Senderismo, montañismo y cañonismo.</li>
        </ul>
        <img src="img/Turismo_10.jpg" alt="Turismo" loading="lazy">
      </section>
      <section data-step="10">
        <h2>Explora los estados</h2>
        <p>Haz clic en un estado en el mapa o en el listado para conocerlo más a fondo:</p>
        <ul>
          <li><a href="estados/baja_california_sur.html">Baja California Sur</a></li>
          <li><a href="estados/hidalgo.html">Hidalgo</a></li>
          <li><a href="estados/michoacan.html">Michoacán</a></li>
          <li><a href="estados/morelos.html">Morelos</a></li>
          <li><a href="estados/nayarit.html">Nayarit</a></li>
          <li><a href="estados/oaxaca.html">Oaxaca</a></li>
          <li><a href="estados/puebla.html">Puebla</a></li>
          <li><a href="estados/tlaxcala.html">Tlaxcala</a></li>
          <li><a href="estados/veracruz.html">Veracruz</a></li>
        </ul>
      </section>
    </div>

    <div id="map"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>

  <script>
    if (window.L && L.Icon && L.Icon.Default) {
      L.Icon.Default.mergeOptions({ imagePath: 'img/' });
    }
  </script>

  <script>
    // Basado en tu js/script.js (antes: initMap({...})) — lo exponemos como initMapLegacy
    // Genera mapa simple dado un contenedor, un geojson y callbacks
    (function(){
      function initMapLegacy({ container, geojson, defaultView, defaultZoom, onEachFeature }) {
        window.map = L.map(container).setView(defaultView, defaultZoom);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);
        fetch(geojson).then(r => r.json()).then(data => L.geoJSON(data, { onEachFeature }).addTo(map));
      }
      window.initMapLegacy = initMapLegacy;
    })();
  </script>

  <script>
    // Carga el mapa cuando #map entra al viewport
    document.addEventListener('DOMContentLoaded', () => {
      const mapEl = document.getElementById('map');
      const obs = new IntersectionObserver((entries, observer) => {
        if (entries[0].isIntersecting) { observer.disconnect(); initMap(); }
      }, { rootMargin: '200px' });
      obs.observe(mapEl);
    });

    function initMap() {
      // 1) Mapa base
      const isStatePage = window.location.pathname.includes('/estados/');
      const basePath    = isStatePage ? '../' : '';
      const map = L.map('map', { zoomControl: false }).setView([23.6345, -102.5528], 5);

      // Satélite (solo imagen)
      L.tileLayer(
        'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
        { attribution: 'Tiles © Esri — Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community' }
      ).addTo(map);

      // 2) Page key
      const pageKey = isStatePage ? window.location.pathname.split('/').pop().replace('.html','') : 'index';

      // 3) Slugs para redirección desde el índice
      const slugMap = {
        'Baja California Sur':'baja_california_sur','Hidalgo':'hidalgo','Michoacán de Ocampo':'michoacan',
        'Morelos':'morelos','Nayarit':'nayarit','Oaxaca':'oaxaca','Puebla':'puebla','Tlaxcala':'tlaxcala',
        'Veracruz de Ignacio de la Llave':'veracruz'
      };

      // 4) Fuente de GeoJSON (todos o por estado)
      const geoUrl = pageKey === 'index'
        ? `${basePath}data/Estados_1.geojson`
        : `${basePath}data/${pageKey}.geojson`;

      // 5) Cargar polígonos
      fetch(geoUrl)
        .then(r => { if (!r.ok) throw new Error(r.statusText); return r.json(); })
        .then(geojson => {
          const layerGroup = L.geoJSON(geojson, {
            style: f => ({ color:'#611232', weight: pageKey==='index' ? 2 : 3, fillOpacity: pageKey==='index' ? 0.3 : 0.2 }),
            onEachFeature: (feature, lyr) => {
              lyr.options.interactive = true;
              const name = feature.properties.Estado;
              if (pageKey === 'index') {
                lyr.on('mouseover', () => lyr.getElement().style.cursor = 'pointer');
                lyr.on('click', () => {
                  const slug = slugMap[name] || slugify(name);
                  window.location.href = `estados/${slug}.html`;
                });
                // Efecto visual al estar listo el SVG
                setTimeout(() => { const el = lyr.getElement(); if (el) el.classList.add('estado-respirar'); }, 0);
              } else {
                // Tabla con propiedades en popup
                const props = feature.properties || {};
                let html = '<table>';
                for (let k in props) html += `<tr><th>${k}</th><td>${props[k]}</td></tr>`;
                html += '</table>';
                lyr.bindPopup(html);
              }
            }
          }).addTo(map);

          // Enfocar al conjunto de polígonos
          const initialBounds = layerGroup.getBounds();
          if (initialBounds.isValid()) map.fitBounds(initialBounds, { padding:[20,20] });

          // --- Puntos para BCS ---
          if (pageKey === 'baja_california_sur') {
            const ecoIcon = L.icon({ iconUrl: `${basePath}img/eco.svg`, iconSize:[32,32], iconAnchor:[16,32] });
            fetch(`${basePath}data/5_Puntos_BCS.geojson`)
              .then(r => { if(!r.ok) throw new Error(r.statusText); return r.json(); })
              .then(pointsGeojson => {
                const points = pointsGeojson.features;
                const pointsLayer = L.geoJSON(pointsGeojson, {
                  pointToLayer: (f, latlng) => L.marker(latlng, { icon: ecoIcon }),
                  onEachFeature: (f, lyr) => {
                    const raw = f.properties;
                    const label = raw.Name || raw.name || raw.nombre || 'Sin título';
                    lyr.bindPopup(label);
                    lyr.on('click', () => {
                      if (map.hasLayer(layerGroup)) map.removeLayer(layerGroup);
                      const b = L.geoJSON(f).getBounds();
                      const optZ = map.getBoundsZoom(b);
                      const tz = optZ > 4 ? optZ - 4 : optZ;
                      map.flyToBounds(b, { padding:[20,20], maxZoom: tz });
                      map.once('moveend', () => lyr.openPopup());

                      const sec = document.querySelector(`#story section[data-index="${f.properties.id}"]`);
                      if (sec) {
                        document.querySelectorAll('#story section').forEach(s => s.classList.remove('is-active'));
                        sec.classList.add('is-active');
                        sec.scrollIntoView({ behavior:'smooth' });
                      }
                    });
                  }
                }).addTo(map);
              })
              .catch(() => console.error('No se pudo cargar 5_Puntos_BCS.geojson'));
          }
        })
        .catch(err => {
          console.error('Error cargando GeoJSON:', err);
          if (pageKey === 'index') alert('No se pudo cargar el mapa de estados.');
        });
    }

    // Utilidad de slug
    function slugify(name){
      return typeof name === 'string'
        ? name.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,'_')
        : '';
    }
  </script>

  <script>
    document.getElementById('nav-toggle').addEventListener('click', () => {
      document.getElementById('nav-menu').classList.toggle('open');
    });
  </script>

  <div id="footer-banner"><img src="img/tittle.png" alt="Turismo Comunitario"></div>

  </body>
</html>
